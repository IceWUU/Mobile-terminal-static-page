(function(w){w.ice=Object.create(null);w.ice.css=function(node,type,val){if(typeof node["transforms"]==="undefined"){node["transforms"]={}}if(arguments.length>=3){var text="";node["transforms"][type]=val;for(item in node["transforms"]){if(node["transforms"].hasOwnProperty(item)){switch(item){case"translateX":case"translateY":case"translateZ":text+=item+"("+node["transforms"][item]+"px)";break;case"scale":text+=item+"("+node["transforms"][item]+")";break;case"rotate":text+=item+"("+node["transforms"][item]+"deg)";break}}}node.style.transform=node.style.webkitTransform=text}else if(arguments.length==2){val=node["transforms"][type];if(typeof val==="undefined"){if(type==="translateX"||type==="translateY"||type==="rotate"){val=0}else if(type==="scale"){val=1}}return val}};w.ice.carouse=function(urls){var pointsFlag=urls.length;var wrap=document.querySelector("#carouse-wrapper");var needCarouse=wrap.getAttribute("needCarouse");needCarouse=needCarouse===null?false:true;if(needCarouse){urls=urls.concat(urls)}var list=document.createElement("ul");ice.css(list,"translateZ",1);var liText="";for(var i=0;i<urls.length;i++){liText+='<li><a href="javascript:;"><img src="'+urls[i]+'" /></a></li>'}list.innerHTML=liText;wrap.appendChild(list);var imgs=document.querySelectorAll("#carouse-wrapper ul > li img");setTimeout(function(){var styleNode=document.createElement("style");styleNode.innerHTML+="#carouse-wrapper ul{width:"+urls.length+"00%!important}";styleNode.innerHTML+="#carouse-wrapper ul > li{width:"+(1/urls.length*100)+"%!important}";styleNode.innerHTML+="#carouse-wrapper {height:"+imgs[0].offsetHeight+"px!important}";document.head.appendChild(styleNode)},100);var pWrap=document.querySelector("#carouse-wrapper .points-wrapper");if(pWrap){var spanText="";for(i=0;i<pointsFlag;i++){if(i==0){spanText+="<span class='active'></span>"}else{spanText+="<span></span>"}}pWrap.innerHTML=spanText;var points=document.querySelectorAll("#carouse-wrapper .points-wrapper > span")}var startX=0;var startY=0;var elementX=0;var elementY=0;var now=0;var isX=true;var isFirst=true;wrap.addEventListener("touchstart",function(ev){ev=ev||event;var touchC=ev.changedTouches[0];if(needCarouse){var now=ice.css(list,"translateX")/document.documentElement.clientWidth;if(now==0){now=-urls.length/2}else if(now==1-urls.length){now=1-urls.length/2}ice.css(list,"translateX",now*document.documentElement.clientWidth)}startX=touchC.clientX;startY=touchC.clientY;elementX=ice.css(list,"translateX");elementY=ice.css(list,"translateY");list.style.transition="none";clearInterval(clearTime);isX=true;isFirst=true});wrap.addEventListener("touchmove",function(ev){if(!isX){return}ev=ev||event;var touchC=ev.changedTouches[0];var nowX=touchC.clientX;var nowY=touchC.clientY;var disX=nowX-startX;var disY=nowY-startY;if(isFirst){isFirst=false;if(Math.abs(disY)>Math.abs(disX)){isX=false;return}}ice.css(list,"translateX",elementX+disX)});wrap.addEventListener("touchend",function(ev){ev=ev||event;var touchC=ev.changedTouches[0];now=ice.css(list,"translateX")/document.documentElement.clientWidth;now=Math.round(now);if(now>0){now=0}else if(now<1-urls.length){now=1-urls.length}moveAuto();if(needAuto){auto()}});var clearTime=0;var needAuto=wrap.getAttribute("needAuto");needAuto=needAuto===null?false:true;if(needAuto){auto()}function auto(){clearInterval(clearTime);clearTime=setInterval(function(){if(now==1-urls.length){list.style.transition="none";now=1-urls.length/2;ice.css(list,"translateX",now*document.documentElement.clientWidth)}setTimeout(function(){now--;moveAuto()},50)},3000)}function moveAuto(){list.style.transition=".5s";ice.css(list,"translateX",now*document.documentElement.clientWidth);if(pWrap){for(var i=0;i<points.length;i++){points[i].className=""}points[-now%pointsFlag].className="active"}}};w.ice.vMove=function(wrap,callBack){var list=wrap.children[0];ice.css(list,"translateZ",1);var minY=wrap.clientHeight-list.offsetHeight;var startP={};var elementP={};var lastTime=0;var lastPoint=0;var timeVal=1;var pointVal=0;var isY=true;var isFirst=true;var Tween={Linear:function(t,b,c,d){return c*t/d+b},Back:function(t,b,c,d,s){if(s==undefined)s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b}};wrap.addEventListener("touchstart",function(ev){ev=ev||event;var touchC=ev.changedTouches[0];minY=wrap.clientHeight-list.offsetHeight;startP={clientX:touchC.clientX,clientY:touchC.clientY};elementP={x:ice.css(list,"translateX"),y:ice.css(list,"translateY")};list.style.transition="none";list.elasticd=false;lastTime=new Date().getTime();lastPoint=touchC.clientY;pointVal=0;isY=true;isFirst=true;clearInterval(wrap.clearTime);if(callBack&&typeof callBack["start"]==="function"){callBack["start"].call(this)}});wrap.addEventListener("touchmove",function(ev){if(!isY){return}ev=ev||event;var touchC=ev.changedTouches[0];var nowP=touchC;var dis={x:nowP.clientX-startP.clientX,y:nowP.clientY-startP.clientY};var translateY=elementP.y+dis.y;var nowTime=new Date().getTime();var nowPoint=touchC.clientY;timeVal=nowTime-lastTime;pointVal=nowPoint-lastPoint;lastPoint=nowPoint;lastTime=nowTime;if(translateY>0){var scale=document.documentElement.clientHeight/((document.documentElement.clientHeight+translateY)*2);translateY=ice.css(list,"translateY")+pointVal*scale;list.elasticd=true}else if(translateY<minY){var over=minY-translateY;var scale=document.documentElement.clientHeight/((document.documentElement.clientHeight+over)*2);translateY=ice.css(list,"translateY")+pointVal*scale;list.elasticd=true}if(isFirst){isFirst=false;if(Math.abs(dis.x)>Math.abs(dis.y)){isY=false;return}}ice.css(list,"translateY",translateY);if(callBack&&typeof callBack["move"]==="function"){callBack["move"].call(this)}});wrap.addEventListener("touchend",function(ev){var speed=pointVal/timeVal;speed=Math.abs(speed)<1?0:speed;var translateY=ice.css(list,"translateY");var targetY=translateY+speed*200;var time=Math.abs(speed)*0.15;time=time>1?1:time;var type="Linear";if(targetY>0){targetY=0;type="Back";if(list.elasticd){time=.5;type="Linear"}}else if(targetY<minY){targetY=minY;type="Back";if(list.elasticd){time=.5;type="Linear"}}move(type,targetY,time)});function move(type,targetY,time){var point=0;var t=0;var b=ice.css(list,"translateY");var c=targetY-b;var d=time/(0.02);var s=1;clearInterval(wrap.clearTime);wrap.clearTime=setInterval(function(){t++;if(t>d){clearInterval(wrap.clearTime);if(callBack&&typeof callBack["end"]==="function"){callBack["end"].call(this)}return}point=Tween[type](t,b,c,d,s);ice.css(list,"translateY",point);if(callBack&&typeof callBack["move"]==="function"){callBack["move"].call(this)}},20)}}})(window);